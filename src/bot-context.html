<template>
  <div class="nav-tabs-custom">
    <ul class="nav nav-tabs">
      <li class="" style="display:none"><a href="#intents" data-toggle="tab" aria-expanded="false">Intents</a></li>
      <li class="active"><a href="#timeline" data-toggle="tab" aria-expanded="true">Flow</a></li>
      <li class=""><a href="#settings" data-toggle="tab" aria-expanded="false">Settings</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane" id="intents" style="display:none">
        <h4>
          Intents
          <small>
            Intents are the identified intended actions a user desired to say.
          </small>
        </h4>
        <table class="table table-bordered">
          <tbody>
            <tr>
              <th style="width: 10px">#</th>
              <th>Example</th>
              <th>Intent</th>
              <th>Triggered Context</th>
              <th>Actions</th>
            </tr>
            <tr>
              <td>1.</td>
              <td>Just about anything...</td>
              <td>Other</td>
              <td>
                Default Context
              </td>
              <td>
                <a class="btn btn-xs btn-default">edit</a>
                <a class="btn btn-xs btn-default">delete</a>
              </td>
            </tr>
            <tr>
              <td>New</td>
              <td><input type="text" class="form-control"></input></td>
              <td>
                <select id="selectbasic" name="selectbasic" class="form-control">
                  <option value="1">Other</option>
                  <option value="2">New...</option>
                </select>
              </td>
              <td>
                <select id="selectbasic" name="selectbasic" class="form-control">
                  <option value="1">Default context</option>
                  <option value="2">Context two</option>
                </select>
              </td>
              <td>
                <a class="btn btn-xs btn-default">save</a>
              </td>
            </tr>
          </tbody>
        </table>
          <!-- /.box-body -->
          <div class="box-footer">
            <button type="submit" class="btn btn-info pull-right">Save & Train</button>
            <button type="submit" class="btn btn-default pull-right">Cancel</button>
          </div>
          <!-- /.box-footer -->
      </div>
      <!-- /.tab-pane -->
      <div  class="tab-pane active" id="timeline">
        <!-- The timeline -->
        <ul  class="timeline timeline-inverse">
          <!-- timeline time label -->
          <li class="time-label">
            <span class="bg-blue">
              ${context.name}
            </span>
          </li>
          <!-- /.timeline-label -->
          <!-- timeline item -->
          <li repeat.for="element of json_Context[context.name]" ref="$root" index.bind="$index">
            <div class="row">
              <div class="col-xs-6 col-md-8 col-lg-10 vcenter">
                <div><i click.delegate="moveUp(json_Context[context.name],element)" class="fa fa-caret-up"></i></div>
                <div><i click.delegate="moveDown(json_Context[context.name],element)" class="fa fa-caret-down"></i></div>
              </div>
            </div>
            <i if.bind="element.type=='text'" class="fa fa-file-text-o bg-blue"></i>
            <i if.bind="element.type=='sender_action'" class="fa fa-send-o bg-blue"></i>
            <i if.bind="element.type=='quick_reply'" class="fa fa-reply bg-blue"></i>
            <div if.bind="element.type=='text'"  class="timeline-item">
              <!--<span class="time"><i class="fa fa-clock-o"></i> 12:05</span>-->
              <h3 class="timeline-header"><a href="#">${element.type}</a></h3>
              <div class="timeline-body">
                <label class="col-sm-2 control-label">Content</label>
                <div class="col-sm-10">
                  <textarea class="form-control" rows="5" value.bind="element.content" change.delegate="elementChanged($index, element)"></textarea>
                </div>
              </div>
              <div class="timeline-footer">
                <button type="button" class="btn btn-default btn-circle btn-xl" click.delegate="removeElement($index)"><i class="fa fa-trash" aria-hidden="true"></i></button>
              </div>
            </div>
            <div if.bind="element.type=='sender_action'"  class="timeline-item">
              <!--<span class="time"><i class="fa fa-clock-o"></i> 12:05</span>-->
              <h3 class="timeline-header"><a href="#">sender action</a></h3>
              <div class="timeline-body">
                <label class="col-sm-2 control-label">Action</label>
                <div class="col-sm-10">
                  <select value.bind="element.sender_action" class="form-control" change.delegate="elementChanged($index, element)" >
                    <option repeat.for="action of SenderActionOptions" model.bind="action.id">${action.name}</option>
                  </select>
                </div>
              </div>
              <div class="timeline-footer">
                <button type="button" class="btn btn-default btn-circle btn-xl" click.delegate="removeElement($index)"><i class="fa fa-trash" aria-hidden="true"></i></button>
              </div>
            </div>
            <div if.bind="element.type=='quick_reply'"  class="timeline-item">
              <!--<span class="time"><i class="fa fa-clock-o"></i> 12:05</span>-->
              <h3 class="timeline-header"><a href="#">Quick Reply</a></h3>
              <div class="timeline-body">
                <label class="col-sm-2 control-label">Content</label>
                <div class="col-sm-10">
                  <textarea class="form-control" rows="5" value.bind="element.content"
                            change.delegate="elementChanged($index, element)"></textarea>
                </div>
                <h5>Quick replies</h5>
                <div class="row">
                  <div repeat.for="item of element.quick_replies" ref="$replies" index.bind="$index">
                    <div class="col-md-3">
                      <label>Content Type</label>
                      <select class="form-control" value.bind="item.content_type" change.delegate="editing_changedItem($replies.index, $root.index, item)">
                        <option value="text">text</option>
                        <option value="location">location</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label >Title</label>
                      <input class="form-control" type="text" value.bind="item.title" change.delegate="editing_changedItem($replies.index, $root.index, item)">
                    </div>
                    <div class="col-md-3">
                      <label >Payload</label>
                      <input class="form-control" type="text"  change.delegate="editing_changedItem($replies.index, $root.index, item)" value.bind="item.payload">
                    </div>
                    <div class="col-md-2">
                      <label >Action</label>
                      <div>
                        <button type="button"
                                class="btn btn-default btn-circle"
                                click.delegate="editing_removeItem($replies.index,$root.index)"
                                disabled.bind="!(element.quick_replies.length>1)">
                          <i class="fa fa-trash" aria-hidden="true"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="timeline-body">
                <button type="button" class="btn btn-default btn-circle" click.delegate="editing_addBlank($index)"><i class="fa fa-plus" aria-hidden="true"></i></button>
              </div>
              <div class="timeline-footer">
                 <button type="button" class="btn btn-default btn-circle btn-xl" click.delegate="removeElement($index)"><i class="fa fa-trash" aria-hidden="true"></i></button>
              </div>
            </div>
          </li>
        </ul>
        <!-- add text element-->
        <div class="panel panel-primary" show.bind="istext" >
          <div class="panel-heading">Adding text element</div>
          <div class="panel-body">
            <label class="col-sm-2 control-label">Content</label>
            <div class="col-sm-10">
              <textarea class="form-control" rows="5" value.bind="ContentValue"></textarea>
            </div>
            <button class="btn btn-primary" click.delegate="additem('text')">Add</button>
          </div>
        </div>
        <!-- ./add text element-->
        <!-- add SA element-->
    		<div class="panel panel-primary" show.bind="isSA">
    			<div class="panel-heading">Adding sender action element</div>
    			<div class="panel-body">
    				<label class="col-sm-2 control-label">Action</label>
    				<div class="col-sm-10">
    					<select value.bind="selectedValSA" class="form-control" >
    						<option repeat.for="action of SenderActionOptions" model.bind="action.id">${action.name}</option>
    					</select>
    				</div>
    				<button class="btn btn-primary" click.delegate="additem('sender_action')">Add</button>
    			</div>
    		</div>
    		<!-- ./add SA element-->
    		<!-- add QR element-->
    		<div class="panel panel-primary" show.bind="isQR">
    			<div class="panel-heading">Adding quick reply element</div>
    			<div class="panel-body">
    				<label class="col-sm-2 control-label">Content</label>
    				<div class="col-sm-10">
    					<textarea class="form-control" rows="5" value.bind="ContentValueQR"></textarea>
    				</div>
    				<label class="col-sm-2 control-label">Quick replies:</label>
    				<div class="col-sm-12">
    					<div class="form-inline" repeat.for="item of items">
    						<div class="form-group">
    							<label>Content Type</label>
    							<select class="form-control" value.bind="item.content_type" change.delegate="changedItem($index, item)">
    								<option value="text">text</option>
    								<option value="location">location</option>
    							</select>
    							<label >Title</label>
    							<input class="form-control" type="text" value.bind="item.title" change.delegate="changedItem($index, item)">
    							<label >Payload</label>
    							<input class="form-control" type="text"  change.delegate="changedItem($index, item)" value.bind="item.payload">
    							<button type="button" class="btn btn-default btn-circle" click.delegate="removeItem($index)" disabled.bind="!canRemove" ><i class="fa fa-trash" aria-hidden="true"></i></button>
    						</div>
    					</div>
    					<button type="button" class="btn btn-default btn-circle" click.delegate="addBlank()"><i class="fa fa-plus" aria-hidden="true"></i></button>
    				</div>
    			</div>
    			<div class="panel-body">
    				<button class="btn btn-primary" click.delegate="additem('quick_reply')">Add</button>
    			</div>
    		</div>
        <!-- ./add QR element-->
        <div class="box-footer">
          <div class="row">
            <div class="col-sm-12">
              <h4 class="text-leftS">Add an element</h4>
              <a class="btn btn-app" click.delegate="elementSelected('text')">
                <i class="fa fa-file-text-o"></i> Text
              </a>
              <a class="btn btn-app" click.delegate="elementSelected('sa')">
                <i class="fa fa-send-o" ></i> Sender Action
              </a>
              <a class="btn btn-app" click.delegate="elementSelected('qr')">
                <i class="fa fa-reply"></i> Quick Reply
              </a>
            </div>
          </div>
        </div>
      </div>
      <!-- /.tab-pane -->
      <div class="tab-pane" id="settings">
        <p>Settings</p>
        <div class="panel-body">
          <form>
            <div class="form-group">
              <label>Name</label>
              <div>
                <input type="text" placeholder="name" class="form-control" value.bind="context.name">
              </div>
            </div>
            <div class="button-bar">
              <button class="btn btn-primary" click.delegate="save()" disabled.bind="!canSave">Save</button>
            </div>
          </form>
        </div>
        <!-- /. panel-body -->
      </div>
      <!-- /.tab-pane -->
    </div>
    <!-- /.tab-content -->
  </div>
</template>
